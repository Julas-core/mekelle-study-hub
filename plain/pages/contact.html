<div class="content-block">
  <h1>Contact Mekelle University</h1>
  <p>Reach out to us for support, inquiries, or feedback about the Course Materials Hub.</p>

  <form id="contactForm">
    <div class="grid" style="grid-template-columns:1fr 1fr;gap:8px;">
      <input name="firstName" placeholder="First name" required />
      <input name="lastName" placeholder="Last name" required />
      <input name="email" type="email" placeholder="your.email@university.edu.et" required />
      <input name="subject" placeholder="Subject" required />
    </div>
    <div style="margin-top:8px;">
      <textarea name="message" rows="6" placeholder="Your message" required></textarea>
    </div>
    <div style="margin-top:8px;">
      <button type="submit">Send Message</button>
    </div>
  </form>

  <div style="margin-top:12px;color:#6b7280;font-size:.9rem">
    You can also contact us at <strong>support@mekelleuniversity.edu.et</strong>
  </div>
</div>

<script>
// Contact handler: prefer Supabase Edge Function `send-contact-email` if available; otherwise try the local demo server; otherwise fallback to console.
import { supabase } from '../js/supabase-client.js'

const form = document.getElementById('contactForm')
form?.addEventListener('submit', async (e) => {
  e.preventDefault()
  const fd = new FormData(form)
  const payload = Object.fromEntries(fd.entries())

  // Try Supabase Edge Function first (if supabase client configured)
  if(supabase){
    try{
      // supabase.functions.invoke is available only when Supabase client is configured to call edge functions
      if(typeof supabase.functions?.invoke === 'function'){
        const { data, error } = await supabase.functions.invoke('send-contact-email', { body: payload })
        if(error) throw error
        alert('Message sent via Supabase Edge Function.')
        form.reset()
        return
      }
    }catch(err){
      console.warn('Supabase function failed, falling back', err)
    }
  }

  // Next: try local demo server
  try{
    const res = await fetch('http://localhost:3001/send-email', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ to: payload.email, subject: payload.subject, html: `<p>${payload.message}</p>` })
    })
    if(res.ok){
      alert('Message sent (via local demo server).')
      form.reset()
      return
    }
  }catch(err){
    console.warn('Local send failed, falling back to console', err)
  }

  console.log('Contact payload:', payload)
  alert('Message prepared â€” check console (no server available).')
})
</script>
